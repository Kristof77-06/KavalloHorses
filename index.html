<!DOCTYPE html>
<html lang="hu">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Termékeink</title>

    <!-- Bootstrap CSS (CDN) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome ikonok (CDN) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />

    <!-- Saját stíluslapok -->
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="mobilmenu.css" />

    <!--
      Menü-specifikus stílusok (beágyazva a head-ben, részletesen)
      Cél: megtartani a balról csúszó vizuális hatást (translateX),
      és ugyanakkor a panel tényleges magasságát JS-sel kezelve helyet foglaljon.
    -->
    <style>
      /* ============================================================
         MENU PANEL STÍLUSOK
         - A panel külön testvér elemként legyen a header után.
         - Zárt állapot: translateX(-100%) + max-height: 0 (nem látszik, nem foglal helyet).
         - Nyitott állapot: translateX(0) + max-height = JS által beállított scrollHeight.
         ============================================================ */

      /* Alap: a panel külön elemként a header után, alapból rejtett */
      #menuPanel {
        box-sizing: border-box;
        width: 100%;
        display: block;                 /* helyet foglal a dokumentumban */
        position: relative;             /* ne legyen absolute/fixed */
        overflow: hidden;               /* animált max-height miatt */
        max-height: 0;                  /* alapból rejtve, helyet nem foglal */
        transition: transform 320ms ease, max-height 320ms ease;
        transform: translateX(-100%);   /* teljesen balra eltolva (eredeti mozgás) */
        background: #222;
        border-bottom: 1px solid #2a2a2a;
        z-index: 50;
        will-change: transform, max-height;
      }

      /* Nyitott állapot: vizuális csúsztatás vissza, max-height-et JS állítja be */
      #menuPanel.open {
        transform: translateX(0); /* vizuálisan bejön balról */
        /* max-height-ot NEM itt adjuk meg; JS állítja panel.style.maxHeight = panel.scrollHeight + 'px' */
      }

      /* Menü lista és linkek */
      #menuPanel .navbar-nav {
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 12px 14px;
        margin: 0;
        list-style: none;
      }

      #menuPanel .nav-item {
        margin: 0;
      }

      #menuPanel .nav-link {
        display: block;
        width: 100%;
        padding: 10px 12px;
        color: #fff;
        text-decoration: none;
        border-radius: 6px;
        background: #1a1a1a;
        border: 1px solid rgba(255,255,255,0.04);
        transition: background 160ms ease, color 160ms ease;
      }

      #menuPanel .nav-link:hover,
      #menuPanel .nav-link:focus {
        background: #2a2a2a;
        color: #fff;
        outline: none;
      }

      /* Kosár számláló stílusa */
      #menuPanel #kosarDb {
        margin-left: 6px;
        color: #ffd;
        font-weight: 600;
      }

      /* Mobil finomhangolás */
      @media (max-width: 768px) {
        #menuPanel .navbar-nav { padding: 10px; }
        #menuPanel .nav-link { padding: 12px 14px; font-size: 16px; }
      }

      /* Segédruletták: pointer-events az aria alapján */
      #menuPanel[aria-hidden="true"] { pointer-events: none; }
      #menuPanel[aria-hidden="false"] { pointer-events: auto; }

      /* Fejléc sticky (megtartva ahogy korábban volt) */
      header.site-header {
        position: sticky;
        top: 0;
        z-index: 10000; /* magasabb, hogy a header fölül maradjon */
        background: #0b0b0b;
        border-bottom: 1px solid #181818;
      }

      /* Mobil keresősáv: mindig látható mobilon (ha így akarod) */
      #mobilKeresosav {
        display: block;
        padding: 8px 16px 12px 16px;
        background: #0b0b0b;
        border-top: 1px solid #181818;
      }
      #mobilKeresosav .form-control {
        background: #fff;
        color: #111;
        border: 1px solid #ccc;
        border-radius: 6px;
      }
      #mobilKeresosav .form-control::placeholder { color: #666; }
    </style>

    <!-- Ha van modul logika, betölthető defer-del -->
    <script type="module" src="main.js" defer></script>
  </head>
  <body>
    <!-- ============================================================
         FEJLÉC ÉS NAVBAR
         A fejléc sticky, a menü külön testvér elemként a header után.
         ============================================================ -->
    <header class="site-header">
      <nav class="navbar navbar-expand-md navbar-dark bg-dark w-100">
        <div class="container-fluid d-flex flex-nowrap align-items-center">
          <!-- Desktop kereső (asztali nézetben látható) -->
          <form
            class="d-none d-sm-flex me-auto"
            role="search"
            onsubmit="event.preventDefault(); keresesInditasa();"
          >
            <input
              type="text"
              id="keresoMezo"
              class="form-control me-2 w-auto"
              placeholder="Keresés..."
            />
            <button type="submit" class="btn btn-outline-light">Keresés</button>
          </form>

          <!-- Mobil kereső gomb (kis képernyőn látható) -->
          <div class="d-sm-none d-flex justify-content-start px-3">
            <button
              class="btn btn-outline-light"
              id="mobilKeresoBtn"
              aria-controls="mobilKeresosav"
              aria-expanded="false"
              aria-label="Mobil keresősáv"
            >
              <i class="fa fa-search"></i>
            </button>
          </div>

          <!-- Menü gomb (saját toggle, nem Bootstrap collapse) -->
          <button
            class="navbar-toggler ms-auto"
            type="button"
            id="hamburgerBtn"
            aria-controls="menuPanel"
            aria-expanded="false"
            aria-label="Menü megnyitása"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>
      </nav>

      <!-- Mobil keresősáv (fejléc alatt) -->
      <div class="d-sm-none px-3" id="mobilKeresosav" aria-hidden="false">
        <input
          type="text"
          id="keresoMezoMobil"
          class="form-control my-2 w-100"
          placeholder="Írd be, amit keresel..."
        />
        <button class="btn btn-primary mb-3 w-100" onclick="keresesInditasa()">
          Keresés indítása
        </button>
      </div>
    </header>

    <!--
      MENÜPANEL
      - Külön testvér elemként a header után.
      - Zárt: translateX(-100%) + max-height: 0
      - Nyitott: translateX(0) + max-height = JS által beállított scrollHeight
    -->
    <nav id="menuPanel" aria-hidden="true">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" href="Kezdolap.html">Kezdőlap</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="rolunk.html">Rólunk</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="index.html">Termékeink</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="kosar.html">
            <i class="fa fa-shopping-cart"></i>
            Kosár
            <span id="kosarDb">(0)</span>
          </a>
        </li>
      </ul>
    </nav>
    <!-- ============================================================
         FŐ TARTALOM
         A menü nyitásakor ennek a tartalomnak lejjebb kell tolódnia.
         ============================================================ -->
    <main class="row">
      <header class="text-center col-lg-12 mt-3 mb-3">
        <h1>Termékeink</h1>
      </header>

      <!-- Szűrési rész -->
      <aside id="szures" class="col-lg-12 mb-4 px-4">
        <div class="d-flex align-items-center justify-content-center">
          <label for="kategoriak" class="fw-bold me-3">Szűrés kategória szerint:</label>
          <select id="kategoriak" class="form-select w-auto">
            <option value="osszes">Összes</option>
            <option value="kiegészítők">Kiegészítők</option>
            <option value="egészség javító">Egészség javító</option>
            <option value="csomagok">Csomagok</option>
          </select>
        </div>
      </aside>

      <aside id="keres" class="col-lg-12 mb-3"></aside>
      <article class="col-lg-12"></article>

      <aside id="termekek" class="col-lg-12 px-4">
        <!-- Ide tölti be a main.js a termekekLISTA tartalmát -->
      </aside>

      <footer class="col-lg-12 text-center mt-4 bg-light py-4">
        <div class="container">
          <p class="mb-1">© 2025 Webshop - Minden jog fenntartva</p>
          <p class="mb-1">Kézzel készült termékek, szeretettel</p>
        </div>
      </footer>
    </main>

    <!-- Megtekintés modal -->
    <div
      class="modal fade"
      id="megtekintesModal"
      tabindex="-1"
      aria-labelledby="megtekintesModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header justify-content-start">
            <button type="button" class="btn btn-link text-dark" data-bs-dismiss="modal" aria-label="Bezárás">
              <i class="fa fa-arrow-left fa-lg"></i>
            </button>
            <h5 class="modal-title ms-2" id="megtekintesModalLabel">Termék megtekintése</h5>
          </div>
          <div class="modal-body" id="modalBody"></div>
          <div class="modal-footer d-none"></div>
        </div>
      </div>
    </div>

    <!-- Külső JS (a body végén) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Javított menü és mobil kereső JS
         - Megtartja az eredeti translateX csúsztatást
         - Ugyanakkor JS-sel beállítja a maxHeight-et, hogy a panel helyet foglaljon
         - ResizeObserver frissít, Esc zár, ARIA attribútumok kezelése
    -->
    <script>
      (function () {
        const btn = document.getElementById('hamburgerBtn');
        const panel = document.getElementById('menuPanel');

        // Biztonsági ellenőrzés: ha nincs panel vagy gomb, ne csináljunk semmit
        if (!panel || !btn) return;

        // Segédfüggvény: beállítja a panel maxHeight-ét a belső tartalom alapján
        function setPanelMaxHeight() {
          // Ha zárt, ne állítsunk nagy értéket (marad 0)
          if (!panel.classList.contains('open')) return;
          // scrollHeight adja a teljes belső magasságot (paddinggal együtt)
          panel.style.maxHeight = panel.scrollHeight + 'px';
        }

        // Megnyitás: osztály hozzáadása + maxHeight beállítása
        function openPanel() {
          panel.classList.add('open');

          // A transform (translateX) miatt a panel vizuálisan bejön.
          // A maxHeight beállítása biztosítja, hogy a dokumentum is növekedjen.
          // requestAnimationFrame biztosítja, hogy a class hozzáadása megtörténjen
          // és a böngésző regisztrálja a kezdeti állapotot.
          requestAnimationFrame(() => {
            panel.style.maxHeight = panel.scrollHeight + 'px';
          });

          panel.setAttribute('aria-hidden', 'false');
          btn.setAttribute('aria-expanded', 'true');
          btn.setAttribute('aria-label', 'Menü bezárása');
        }

        // Bezárás: rögzítjük a jelenlegi magasságot, majd 0-ra állítjuk
        function closePanel() {
          // Ha nincs nyitva, nincs mit csinálni
          if (!panel.classList.contains('open')) return;

          // Rögzítjük a jelenlegi magasságot, hogy a transition sima legyen
          panel.style.maxHeight = panel.scrollHeight + 'px';

          // A következő frame-en állítjuk 0-ra, így a transition lefut
          requestAnimationFrame(() => {
            panel.style.maxHeight = '0px';
          });

          // Várjunk egy kicsit, hogy a transition lefusson, majd eltávolítjuk az .open osztályt.
          // Ez megakadályozza, hogy a transform hirtelen visszaugráljon.
          // 320ms a transition ideje; 350ms után eltávolítjuk az osztályt.
          setTimeout(() => {
            panel.classList.remove('open');
            // Ha szeretnéd, itt is beállíthatnánk transform: translateX(-100%) explicit módon,
            // de a CSS .open szabálya/hiánya már kezeli a translateX értéket.
          }, 350);

          panel.setAttribute('aria-hidden', 'true');
          btn.setAttribute('aria-expanded', 'false');
          btn.setAttribute('aria-label', 'Menü megnyitása');
        }

        // Toggle
        function toggleMenu() {
          if (panel.classList.contains('open')) {
            closePanel();
          } else {
            openPanel();
          }
        }

        // Események
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          toggleMenu();
        });

        // Esc zárás
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && panel.classList.contains('open')) {
            closePanel();
          }
        });

        // Ha a panel tartalma dinamikusan változik (pl. main.js tölti be a menüt),
        // a ResizeObserver frissíti a maxHeight-et nyitott állapotban.
        if ('ResizeObserver' in window) {
          new ResizeObserver(() => {
            if (panel.classList.contains('open')) {
              panel.style.maxHeight = panel.scrollHeight + 'px';
            }
          }).observe(panel);
        } else {
          // Fallback: ha nincs ResizeObserver, frissítsük időnként (ritkán)
          let fallbackInterval = null;
          function startFallback() {
            if (fallbackInterval) return;
            fallbackInterval = setInterval(() => {
              if (panel.classList.contains('open')) {
                panel.style.maxHeight = panel.scrollHeight + 'px';
              } else {
                clearInterval(fallbackInterval);
                fallbackInterval = null;
              }
            }, 300);
          }
          // Indítsuk, ha megnyitjuk
          const originalOpen = openPanel;
          openPanel = function () {
            originalOpen();
            startFallback();
          };
        }

        // Mobil kereső gomb: fókusz az inputra
        const mobilBtn = document.getElementById('mobilKeresoBtn');
        const mobilInput = document.getElementById('keresoMezoMobil');
        if (mobilBtn && mobilInput) {
          mobilBtn.addEventListener('click', (e) => {
            e.preventDefault();
            // Ha a mobil keresősáv a menü része lenne, itt lehetne toggle-olni.
            // Jelenleg csak fókuszáljuk az inputot.
            mobilInput.focus();
          });
        }

        // Accessibility extra: ha a menü nyitva van és a felhasználó a tabbal elhagyja,
        // ne veszítsük el a fókusz kezelést (egyszerű megoldás: ha a fókusz kimegy a menüből,
        // zárjuk be). Ez opcionális, csak ha szeretnéd.
        panel.addEventListener('focusout', (e) => {
          // Ha a fókusz teljesen kimegy a panelből, zárjuk be (opcionális viselkedés).
          // const related = e.relatedTarget;
          // if (!panel.contains(related) && panel.classList.contains('open')) {
          //   closePanel();
          // }
        });
      })();
    </script>
  </body>
</html>